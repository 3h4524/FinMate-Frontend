<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title id="page-title">Order Confirmation</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="../assets/js/autho_helper.js" defer></script>
    <style>
        @keyframes popUp {
            0% {
                transform: scale(0);
                opacity: 0;
            }

            80% {
                transform: scale(1.2);
                opacity: 1;
            }

            100% {
                transform: scale(1);
            }
        }

        .animate-pop-up {
            animation: popUp 0.6s ease-in-out;
        }
    </style>
</head>

<body
    class="bg-gradient-to-br from-gray-900 to-gray-700 text-white font-sans min-h-screen flex items-center justify-center">
    <div id="confirmation-container" class="max-w-lg bg-gray-800 p-10 rounded-2xl text-center shadow-2xl border-2">
        <div id="confirmation-icon" class="text-6xl mb-4 animate-pop-up"></div>
        <h1 id="confirmation-title" class="text-2xl font-bold mb-4"></h1>
        <p id="confirmation-message" class="text-lg text-gray-300 mb-6"></p>
        <a id="confirmation-button" href="#"
            class="inline-block px-5 py-3 text-lg font-bold text-black rounded-lg transition-transform duration-300"></a>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:8080';

        async function fetchPaymentStatus() {
            console.log("Vao fetch ne");
            try {
                const urlParams = new URLSearchParams(window.location.search);
                console.log("rescode: ", urlParams.get('vnp_ResponseCode'));
                console.log("vnp_TxnRef: ", urlParams.get('vnp_TxnRef'));

                const params = {
                    vnp_ResponseCode: urlParams.get('vnp_ResponseCode'),
                    vnp_TxnRef: urlParams.get('vnp_TxnRef')
                };
                console.log("truoc khi fetch ne");

                const response = await apiRequest(`${API_BASE_URL}/api/payment/return`, {
                    method: 'POST',
                    body: JSON.stringify(params)
                });
                const data = await response.json();

                console.log("data: ", data);

                if (data.code === 1000) {
                    updateUI(data.result);
                } else {
                    console.log("that bai");
                    updateUI(data.result);
                }
            } catch (error) {
                console.error('Error fetching payment status:', error);
                updateUI(false);
            }
        }

        function updateUI(isSuccess) {
            const container = document.getElementById('confirmation-container');
            const icon = document.getElementById('confirmation-icon');
            const title = document.getElementById('confirmation-title');
            const message = document.getElementById('confirmation-message');
            const button = document.getElementById('confirmation-button');
            const pageTitle = document.getElementById('page-title');

            if (isSuccess) {
                container.classList.add('border-yellow-400');
                icon.innerHTML = '✔️';
                icon.classList.add('text-cyan-400', 'drop-shadow-[0_0_10px_rgba(0,255,234,0.8)]');
                title.textContent = 'Order Placed Successfully!';
                title.classList.add('text-cyan-400', 'drop-shadow-[0_0_10px_rgba(0,255,234,0.8)]');
                message.textContent = 'Thank you for your purchase. Your order has been confirmed.';
                button.textContent = 'Back to Home';
                button.href = 'home';
                button.classList.add('bg-gradient-to-r', 'from-yellow-400', 'to-yellow-600', 'hover:from-yellow-300', 'hover:to-yellow-500', 'hover:shadow-[0_0_15px_rgba(255,215,0,0.8)]', 'hover:scale-105');
                pageTitle.textContent = 'Order Confirmation';
            } else {
                container.classList.add('border-red-500');
                icon.innerHTML = '❌';
                icon.classList.add('text-red-500', 'drop-shadow-[0_0_15px_rgba(255,0,0,0.8)]');
                title.textContent = 'Order Failed!';
                title.classList.add('text-red-500', 'drop-shadow-[0_0_15px_rgba(255,0,0,0.8)]');
                message.textContent = 'Something went wrong. Please try again.';
                button.textContent = 'Try Again';
                button.href = 'checkOut.html';
                button.classList.add('bg-gradient-to-r', 'from-red-500', 'to-red-700', 'hover:from-red-400', 'hover:to-red-600', 'hover:shadow-[0_0_15px_rgba(255,0,0,0.8)]', 'hover:scale-105');
                pageTitle.textContent = 'Order Failed';
            }
        }

        // Fetch payment status on page load
        window.onload = fetchPaymentStatus;
    </script>
</body>

</html>